{#let document=data moneda=data.moneda}
<?xml version="1.0" encoding="ISO-8859-1"?>
<Invoice xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
         {#include ubl/standard/include/namespaces.xml /}
>
    {#include ubl/standard/include/ubl-extensions.xml /}
    {#include ubl/standard/include/general-data.xml item=document /}
    <cbc:InvoiceTypeCode listID="0101" listAgencyName="PE:SUNAT" listName="Tipo de Documento" listURI="urn:pe:gob:sunat:cpe:see:gem:catalogos:catalogo01">{document.tipoComprobante}</cbc:InvoiceTypeCode>
    <cbc:DocumentCurrencyCode listID="ISO 4217 Alpha" listAgencyName="United Nations Economic Commission for Europe" listName="Currency">{document.moneda}</cbc:DocumentCurrencyCode>
    {#include ubl/common/signature.xml  firmante=document.firmante /}
    {#include ubl/standard/include/supplier.xml proveedor=document.proveedor /}
    {#include ubl/standard/include/customer.xml cliente=document.cliente /}
    <cac:PaymentTerms>
        <cbc:ID>FormaPago</cbc:ID>
        <cbc:PaymentMeansID>{document.formaDePago}</cbc:PaymentMeansID>
        {#if document.formaDePago == 'Credito'}
        <cbc:Amount currencyID="{moneda}">{document.formaDePagoTotal.currency}</cbc:Amount>
        {/if}
    </cac:PaymentTerms>
    {#each document.formaDePagoCuotas.orEmpty}
    <cac:PaymentTerms>
        <cbc:ID>FormaPago</cbc:ID>
        <cbc:PaymentMeansID>Cuota{it_index.add(1).format('%03d')}</cbc:PaymentMeansID>
        <cbc:Amount currencyID="{moneda}">{it.importe.currency}</cbc:Amount>
        <cbc:PaymentDueDate>{it.fechaPago}</cbc:PaymentDueDate>
    </cac:PaymentTerms>
    {/each}
    {#include ubl/standard/include/tax-total.xml totalImpuestos=document.totalImpuestos /}
    {#include ubl/standard/include/monetary-total.xml totalImporte=document.totalImporte /}
    {#each document.detalle.orEmpty}
    <cac:InvoiceLine>
        <cbc:ID>{it_index.add(1)}</cbc:ID>
        <cbc:InvoicedQuantity unitCode="{it.unidadMedida}" unitCodeListAgencyName="United Nations Economic Commission for Europe" unitCodeListID="UN/ECE rec 20">{it.cantidad}</cbc:InvoicedQuantity>
        {#include ubl/standard/include/document-line.xml item=it /}
    </cac:InvoiceLine>
    {/each}
</Invoice>
{/let}